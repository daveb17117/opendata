<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>SBB Verspätungen</title>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css"/>
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet'/>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="css/application.css"/>
</head>
<body>
<script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js" charset="utf-8"></script>
<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
<script type="text/javascript">
    L.MarkerClusterGroup.include({
        refreshClusters: function (layers) {
            if (!layers) {
                layers = this._topClusterLevel.getAllChildMarkers();
            } else if (layers instanceof L.MarkerClusterGroup) {
                layers = layers._topClusterLevel.getAllChildMarkers();
            } else if (layers instanceof L.LayerGroup) {
                layers = layers._layers;
            } else if (layers instanceof L.MarkerCluster) {
                layers = layers.getAllChildMarkers();
            } else if (layers instanceof L.Marker) {
                layers = [layers];
            } // else: must be an Array(L.Marker)|Map(L.Marker)
            this._flagParentsIconsNeedUpdate(layers);
            this._refreshClustersIcons();

            // In case of singleMarkerMode, also re-draw the markers.
            if (this.options.singleMarkerMode) {
                this._refreshSingleMarkerModeMarkers(layers);
            }

            return this;
        },

        _flagParentsIconsNeedUpdate: function (layers) {
            var id, parent;

            // Assumes layers is an Array or an Object whose prototype is non-enumerable.
            for (id in layers) {
                // Flag parent clusters' icon as "dirty", all the way up.
                // Dumb process that flags multiple times upper parents, but still
                // much more efficient than trying to be smart and make short lists,
                // at least in the case of a hierarchy following a power law:
                // http://jsperf.com/flag-nodes-in-power-hierarchy/2
                parent = layers[id].__parent;
                while (parent) {
                    parent._iconNeedsUpdate = true;
                    parent = parent.__parent;
                }
            }
        },

        _refreshSingleMarkerModeMarkers: function (layers) {
            var id, layer;

            for (id in layers) {
                layer = layers[id];

                // Make sure we do not override markers that do not belong to THIS group.
                if (this.hasLayer(layer)) {
                    // Need to re-create the icon first, then re-draw the marker.
                    layer.setIcon(this._overrideMarkerIcon(layer));
                }
            }
        }
    });

    L.Marker.include({

        refreshIconOptions: function (options, directlyRefreshClusters) {
            var icon = this.options.icon;

            L.setOptions(icon, options);

            this.setIcon(icon);

            // Shortcut to refresh the associated MCG clusters right away.
            // To be used when refreshing a single marker.
            // Otherwise, better use MCG.refreshClusters() once at the end with
            // the list of modified markers.
            if (directlyRefreshClusters && this.__parent) {
                this.__parent._group.refreshClusters(this);
            }

            return this;
        }
    })
</script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<div class="container-fluid" id="mainContainer">
    <div id="mySidenav" class="sidenav">
        <div class="sidenavTextarea">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <form>
                <div id="sidenavTitle">
                    Filter
                </div>
                Ab wie vielen Minuten gilt ein Zug als verspätet?
                <!-- For inline-radiobuttons (2 per line)
                <div class="form-group" style="padding-top: 0.4em">
                    <label class="radio-inline">
                        <input type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1"> 1 min
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2"> 2 min
                    </label>
                    <br>
                    <label class="radio-inline">
                        <input type="radio" name="inlineRadioOptions" id="inlineRadio3" value="option3"> 3 min
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="inlineRadioOptions" id="inlineRadio4" value="option4"> 4 min
                    </label>
                </div>
                -->
                <div class="form-group" style="padding-top: 0.4em; padding-left: 2.2em;">
                    <label class="radio" for="radio1min">
                        <input type="radio" name="inlineRadioOptions" id="radio1min" value="option1" onclick="redraw()"> 1 min
                    </label>
                    <label class="radio" for="radio2min">
                        <input type="radio" name="inlineRadioOptions" id="radio2min" value="option2" onclick="redraw()"> 2 min
                    </label>
                    <label class="radio" for="radio3min">
                        <input type="radio" name="inlineRadioOptions" id="radio3min" value="option3" checked="checked" onclick="redraw()"> 3 min
                    </label>
                    <label class="radio" for="radio4min">
                        <input type="radio" name="inlineRadioOptions" id="radio4min" value="option4" onclick="redraw()"> 4 min
                    </label>
                </div>
            </form>
            <a href="#">About</a>
            <a href="#">Services</a>
            <a href="#">Clients</a>
            <a href="#">Contact</a>
        </div>
    </div>
    <button id="opennav" class="btn btn-default" style="z-index: 3;" onclick="openNav()"><span class="fa fa-filter"></span> Filter</button>
    <div id="title">
        <div id="titlediv">
            <span style="font-size: 1.5em">SBB Transportdaten</span>
            <span id="closetitle">&times;</span>
            <p>
                Diese App zeigt Daten der SBB. Die Daten wurden vom <a target="_blank" href="https://data.sbb.ch/pages/einstieg/">SBB-Datenportal</a> heruntergeladen und
                danach weiterverarbeitet. Oben rechts gibt es eine Filter Option.
                <br>
                Weitere Informationen finden Sie auf unserem <a target="_blank" href="https://github.com/daveb17117/opendata"><span class="fa fa-github"></span> Gihub Repository</a>.
            </p>
        </div>
    </div>
    <!-- Legend. Not too elegant this way, JavaScript would be nicer. -->
    <div id="legend">
        <span class="legendheading">
            Zugverspätungen
        </span>
        <br>
        <div class="legenditem category-4">
            Pünktlich
        </div>
        <div class="legenditem category-2">
            Verspätet
        </div>
        <div class="legenditem category-1">
            Ausgefallen
        </div>
    </div>
    <div id="map"></div>
</div>

<script src="js/style.js"></script>
<script src="js/api.js"></script>
<script src="js/application.js"></script>
</body>
</html>